/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ElementRef, Renderer2, HostListener } from '@angular/core';
/**
 * @record
 */
function CloudOptionsInternal() { }
if (false) {
    /**
     * setting the aspect ratio. This value is calculated by the given width and height
     * @type {?}
     */
    CloudOptionsInternal.prototype.aspectRatio;
    /** @type {?} */
    CloudOptionsInternal.prototype.center;
}
export class TagCloudComponent {
    /**
     * @param {?} el
     * @param {?} r2
     */
    constructor(el, r2) {
        this.el = el;
        this.r2 = r2;
        this.clicked = new EventEmitter();
        this.dataChanges = new EventEmitter();
        this.afterInit = new EventEmitter();
        this.afterChecked = new EventEmitter();
        this.alreadyPlacedWords = [];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResize(event) {
        this.logMessage('debug', 'rezisze triggered');
        window.clearTimeout(this.timeoutId);
        this.timeoutId = window.setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.options.realignOnResize) {
                this.reDraw();
            }
        }), 200);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.logMessage('debug', 'ngOnChanges fired', changes);
        // set default values
        this.config = Object.assign({ width: 500, height: 300, overflow: true, strict: false, zoomOnHover: {
                transitionTime: 0,
                scale: 1,
                delay: 0,
                color: null
            }, realignOnResize: false, randomizeAngle: false, background: null, font: null, step: 2.0, log: false }, this.config // override default width params in config object
        );
        // override properties if explicitly set
        if (this.width) {
            this.config.width = this.width;
        }
        if (this.height) {
            this.config.height = this.height;
        }
        if (typeof this.overflow === 'boolean') {
            this.config.overflow = this.overflow;
        }
        if (typeof this.strict === 'boolean') {
            this.config.strict = this.strict;
        }
        if (typeof this.realignOnResize === 'boolean') {
            this.config.realignOnResize = this.realignOnResize;
        }
        if (typeof this.randomizeAngle === 'boolean') {
            this.config.randomizeAngle = this.randomizeAngle;
        }
        if (typeof this.background === 'string') {
            this.config.background = this.background;
        }
        if (typeof this.font === 'string') {
            this.config.font = this.font;
        }
        if (this.zoomOnHover) {
            this.config.zoomOnHover = this.zoomOnHover;
        }
        if (this.step) {
            this.config.step = this.step;
        }
        if (this.log) {
            this.config.log = this.log;
        }
        this.logMessage('warn', 'cloud configuration', this.config);
        // set the basic font style if property is provided
        if (this.config.font) {
            this.r2.setStyle(this.el.nativeElement, 'font', this.config.font);
        }
        // set a background image if property is provided
        if (this.config.background) {
            this.r2.setStyle(this.el.nativeElement, 'background', this.config.background);
        }
        this.reDraw(changes);
    }
    /**
     * @param {?=} changes
     * @return {?}
     */
    reDraw(changes) {
        this.dataChanges.emit(changes);
        this.afterChecked.emit();
        this.logMessage('debug', 'dataChanges emitted');
        this.alreadyPlacedWords = [];
        // check if data is not null or empty
        if (!this.data) {
            console.error('angular-tag-cloud: No data passed. Please pass an Array of CloudData');
            return;
        }
        // values changed, reset cloud
        this.el.nativeElement.innerHTML = '';
        // set value changes
        if (changes && changes.data) {
            this.dataArr = changes.data.currentValue;
        }
        // calculate width and height
        /** @type {?} */
        let width = this.config.width;
        if (this.el.nativeElement.parentNode.offsetWidth > 0
            && width <= 1
            && width > 0) {
            width = this.el.nativeElement.parentNode.offsetWidth * width;
        }
        /** @type {?} */
        const height = this.config.height;
        // set options
        this.options = Object.assign({}, this.config, { aspectRatio: (width / height), width, center: {
                x: (width / 2.0),
                y: (height / 2.0)
            } });
        // set the dimensions
        this.r2.setStyle(this.el.nativeElement, 'width', this.options.width + 'px');
        this.r2.setStyle(this.el.nativeElement, 'height', this.options.height + 'px');
        // draw the cloud
        this.drawWordCloud();
        this.logMessage('debug', 'reDraw finished');
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.afterInit.emit();
        this.logMessage('debug', 'afterInit emitted');
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        this.afterChecked.emit();
        this.logMessage('debug', 'afterChecked emitted');
    }
    // helper to generate a descriptive string for an entry to use when sorting alphabetically
    /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    descriptiveEntry(entry) {
        /** @type {?} */
        let description = entry.text;
        if (entry.color) {
            description += '-' + entry.color;
        }
        if (entry.external) {
            description += '-' + entry.external;
        }
        if (entry.link) {
            description += '-' + entry.link;
        }
        if (entry.rotate) {
            description += '-' + entry.rotate;
        }
        return description;
    }
    /**
     * @private
     * @return {?}
     */
    drawWordCloud() {
        // Sort alphabetically to ensure that, all things being equal, words are placed uniformly
        this.dataArr.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => (this.descriptiveEntry(a)).localeCompare(this.descriptiveEntry(b))));
        // Sort this._dataArr from the word with the highest weight to the one with the lowest
        this.dataArr.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => b.weight - a.weight));
        this.dataArr.forEach((/**
         * @param {?} elem
         * @param {?} index
         * @return {?}
         */
        (elem, index) => {
            this.drawWord(index, elem);
        }));
    }
    // Helper function to test if an element overlaps others
    /**
     * @private
     * @param {?} testEl
     * @return {?}
     */
    hitTest(testEl) {
        // Check elements for overlap one by one, stop and return false as soon as an overlap is found
        for (const item of this.alreadyPlacedWords) {
            if (this.overlapping(testEl, item)) {
                return true;
            }
        }
        return false;
    }
    // Pairwise overlap detection
    /**
     * @private
     * @param {?} e1
     * @param {?} e2
     * @return {?}
     */
    overlapping(e1, e2) {
        /** @type {?} */
        const rect1 = e1.getBoundingClientRect();
        /** @type {?} */
        const rect2 = e2.getBoundingClientRect();
        /** @type {?} */
        const overlap = !(rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom);
        return overlap;
    }
    // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
    /**
     * @private
     * @param {?} index
     * @param {?} word
     * @return {?}
     */
    drawWord(index, word) {
        // Define the ID attribute of the span that will wrap the word
        /** @type {?} */
        let angle = this.options.randomizeAngle ? 6.28 * Math.random() : 0;
        /** @type {?} */
        let radius = 0;
        /** @type {?} */
        let weight = 5;
        /** @type {?} */
        let wordSpan;
        // Check if min(weight) > max(weight) otherwise use default
        if (this.dataArr[0].weight > this.dataArr[this.dataArr.length - 1].weight) {
            // check if strict mode is active
            if (!this.options.strict) { // Linearly map the original weight to a discrete scale from 1 to 10
                weight = Math.round((word.weight - this.dataArr[this.dataArr.length - 1].weight) /
                    (this.dataArr[0].weight - this.dataArr[this.dataArr.length - 1].weight) * 9.0) + 1;
            }
            else { // use given value for weigth directly
                // fallback to 10
                if (word.weight > 10) {
                    weight = 10;
                    this.logMessage('warn', `[TagCloud strict] Weight property ${word.weight} > 10. Fallback to 10 as you are using strict mode`, word);
                }
                else if (word.weight < 1) { // fallback to 1
                    weight = 1;
                    this.logMessage('warn', `[TagCloud strict] Given weight property ${word.weight} < 1. Fallback to 1 as you are using strict mode`, word);
                }
                else if (word.weight % 1 !== 0) { // round if given value is not an integer
                    weight = Math.round(word.weight);
                    this.logMessage('warn', `[TagCloud strict] Given weight property ${word.weight} is not an integer. Rounded value to ${weight}`, word);
                }
                else {
                    weight = word.weight;
                }
            }
        }
        // Create a new span and insert node.
        wordSpan = this.r2.createElement('span');
        wordSpan.className = 'w' + weight;
        /** @type {?} */
        const thatClicked = this.clicked;
        wordSpan.onclick = (/**
         * @return {?}
         */
        () => {
            thatClicked.emit(word);
        });
        /** @type {?} */
        let node = this.r2.createText(word.text);
        // set color
        if (word.color) {
            this.r2.setStyle(wordSpan, 'color', word.color);
        }
        /** @type {?} */
        let transformString = '';
        // set color
        if (word.rotate) {
            transformString = `rotate(${word.rotate}deg)`;
            this.r2.setStyle(wordSpan, 'transform', transformString);
        }
        // Append href if there's a link alongwith the tag
        if (word.link) {
            /** @type {?} */
            const wordLink = this.r2.createElement('a');
            wordLink.href = word.link;
            if (word.external !== undefined && word.external) {
                wordLink.target = '_blank';
            }
            wordLink.appendChild(node);
            node = wordLink;
        }
        // set zoomOption
        if (this.options.zoomOnHover && this.options.zoomOnHover.scale !== 1) {
            if (!this.options.zoomOnHover.transitionTime) {
                this.options.zoomOnHover.transitionTime = 0;
            }
            if (!this.options.zoomOnHover.scale) {
                this.options.zoomOnHover.scale = 1;
            }
            wordSpan.onmouseover = (/**
             * @return {?}
             */
            () => {
                this.r2.setStyle(wordSpan, 'transition', `transform ${this.options.zoomOnHover.transitionTime}s`);
                this.r2.setStyle(wordSpan, 'transform', `scale(${this.options.zoomOnHover.scale}) ${transformString}`);
                this.r2.setStyle(wordSpan, 'transition-delay', `${this.options.zoomOnHover.delay}s`);
                if (this.options.zoomOnHover.color) {
                    word.link
                        ? this.r2.setStyle(node, 'color', this.options.zoomOnHover.color)
                        : this.r2.setStyle(wordSpan, 'color', this.options.zoomOnHover.color);
                }
            });
            wordSpan.onmouseout = (/**
             * @return {?}
             */
            () => {
                this.r2.setStyle(wordSpan, 'transform', `none ${transformString}`);
                word.link
                    ? this.r2.removeStyle(node, 'color')
                    : this.r2.removeStyle(wordSpan, 'color');
            });
        }
        wordSpan.appendChild(node);
        this.r2.appendChild(this.el.nativeElement, wordSpan);
        /** @type {?} */
        const width = wordSpan.offsetWidth;
        /** @type {?} */
        const height = wordSpan.offsetHeight;
        /** @type {?} */
        let left = this.options.center.x - (width / 2);
        /** @type {?} */
        let top = this.options.center.y - (height / 2);
        // Save a reference to the style property, for better performance
        /** @type {?} */
        const wordStyle = wordSpan.style;
        wordStyle.position = 'absolute';
        // place the first word
        wordStyle.left = left + 'px';
        wordStyle.top = top + 'px';
        // add tooltip if provided
        if (word.tooltip) {
            this.r2.addClass(wordSpan, 'tooltip');
            /** @type {?} */
            const tooltipSpan = this.r2.createElement('span');
            tooltipSpan.className = 'tooltiptext';
            /** @type {?} */
            const text = this.r2.createText(word.tooltip);
            tooltipSpan.appendChild(text);
            wordSpan.appendChild(tooltipSpan);
        }
        // set a unique id
        wordSpan.id = `angular-tag-cloud-item-${index}`;
        while (this.hitTest(wordSpan)) {
            radius += this.options.step;
            angle += (index % 2 === 0 ? 1 : -1) * this.options.step;
            left = this.options.center.x - (width / 2.0) + (radius * Math.cos(angle)) * this.options.aspectRatio;
            top = this.options.center.y + radius * Math.sin(angle) - (height / 2.0);
            wordStyle.left = left + 'px';
            wordStyle.top = top + 'px';
        }
        // do not place the first word always right in the middle
        if (index === 0) {
            wordStyle.left = left + ((Math.random() - 0.5) * 2) * (this.options.width / 5) + 'px';
            wordStyle.top = top + ((Math.random() - 0.5) * 2) * (this.options.height / 5) + '30px';
        }
        // Don't render word if part of it would be outside the container
        if (!this.options.overflow &&
            (left < 0 || top < 0 || (left + width) > this.options.width ||
                (top + height) > this.options.height)) {
            this.logMessage('warn', 'Word did not fit into the cloud and overflow is set to \'false\'. The element will be removed', wordSpan);
            wordSpan.remove();
            return;
        }
        this.logMessage('debug', 'Adds new word <span>', wordSpan);
        this.alreadyPlacedWords.push(wordSpan);
        this.logMessage('debug', 'Placed words', this.alreadyPlacedWords);
    }
    /**
     * @private
     * @param {?} level
     * @param {...?} args
     * @return {?}
     */
    logMessage(level, ...args) {
        if (!this.config) {
            return;
        }
        if (this.config.log === 'debug') {
            console.log(`[AngularTagCloudModule ${level}]`, ...args);
        }
        else if (this.config.log === 'warn' && level === 'warn') {
            console.warn(`[AngularTagCloudModule ${level}]`, ...args);
        }
    }
}
TagCloudComponent.decorators = [
    { type: Component, args: [{
                selector: 'angular-tag-cloud, ng-tag-cloud, ngtc',
                template: '',
                styles: [":host{font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:normal;color:#09f;overflow:hidden;position:relative;display:block}span{padding:0}span.w10{font-size:550%}span.w9{font-size:500%}span.w8{font-size:450%}span.w7{font-size:400%}span.w6{font-size:350%}span.w5{font-size:300%}span.w4{font-size:250%}span.w3{font-size:200%}span.w2{font-size:150%}a:hover,span.w10,span.w8,span.w9{color:#0cf}span.w7{color:#39d}span.w6{color:#90c5f0}span.w5{color:#90a0dd}span.w4{color:#90c5f0}span.w3{color:#a0ddff}span.w2{color:#9ce}span.w1{font-size:100%;color:#aab5f0}.tooltip .tooltiptext{visibility:hidden;width:inherit;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 10px;position:absolute;bottom:100%;left:0;opacity:0;transition:opacity .3s}.tooltip .tooltiptext::after{content:\"\";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent}.tooltip:hover .tooltiptext{visibility:visible;opacity:1}"]
            }] }
];
/** @nocollapse */
TagCloudComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TagCloudComponent.propDecorators = {
    data: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    step: [{ type: Input }],
    overflow: [{ type: Input }],
    strict: [{ type: Input }],
    zoomOnHover: [{ type: Input }],
    realignOnResize: [{ type: Input }],
    randomizeAngle: [{ type: Input }],
    background: [{ type: Input }],
    font: [{ type: Input }],
    config: [{ type: Input }],
    log: [{ type: Input }],
    clicked: [{ type: Output }],
    dataChanges: [{ type: Output }],
    afterInit: [{ type: Output }],
    afterChecked: [{ type: Output }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    TagCloudComponent.prototype.data;
    /** @type {?} */
    TagCloudComponent.prototype.width;
    /** @type {?} */
    TagCloudComponent.prototype.height;
    /** @type {?} */
    TagCloudComponent.prototype.step;
    /** @type {?} */
    TagCloudComponent.prototype.overflow;
    /** @type {?} */
    TagCloudComponent.prototype.strict;
    /** @type {?} */
    TagCloudComponent.prototype.zoomOnHover;
    /** @type {?} */
    TagCloudComponent.prototype.realignOnResize;
    /** @type {?} */
    TagCloudComponent.prototype.randomizeAngle;
    /** @type {?} */
    TagCloudComponent.prototype.background;
    /** @type {?} */
    TagCloudComponent.prototype.font;
    /** @type {?} */
    TagCloudComponent.prototype.config;
    /** @type {?} */
    TagCloudComponent.prototype.log;
    /** @type {?} */
    TagCloudComponent.prototype.clicked;
    /** @type {?} */
    TagCloudComponent.prototype.dataChanges;
    /** @type {?} */
    TagCloudComponent.prototype.afterInit;
    /** @type {?} */
    TagCloudComponent.prototype.afterChecked;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.dataArr;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.alreadyPlacedWords;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.options;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.timeoutId;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.r2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFnLWNsb3VkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItdGFnLWNsb3VkLW1vZHVsZS8iLCJzb3VyY2VzIjpbImxpYi90YWctY2xvdWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUlULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDVixTQUFTLEVBRVQsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7O0FBRzdDLG1DQVNDOzs7Ozs7SUFMQywyQ0FBb0I7O0lBQ3BCLHNDQUdFOztBQVFKLE1BQU0sT0FBTyxpQkFBaUI7Ozs7O0lBMEI1QixZQUNVLEVBQWMsRUFDZCxFQUFhO1FBRGIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQVc7UUFiYixZQUFPLEdBQTZCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDdkQsZ0JBQVcsR0FBaUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUMvRCxjQUFTLEdBQXdCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDcEQsaUJBQVksR0FBd0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUd6RCx1QkFBa0IsR0FBa0IsRUFBRSxDQUFDO0lBUTNDLENBQUM7Ozs7O0lBRXNDLFFBQVEsQ0FBQyxLQUFVO1FBQzVELElBQUksQ0FBQyxVQUFVLENBQ2IsT0FBTyxFQUNQLG1CQUFtQixDQUNwQixDQUFDO1FBQ0YsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVTs7O1FBQUMsR0FBRyxFQUFFO1lBQ3RDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUNmO1FBQ0gsQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsQ0FB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QXNCZixLQUFLO29CQUNMLEtBQUs7cUJBQ0wsS0FBSzttQkFDTCxLQUFLO3VCQUNMLEtBQUs7cUJBQ0wsS0FBSzswQkFDTCxLQUFLOzhCQUNMLEtBQUs7NkJBQ0wsS0FBSzt5QkFDTCxLQUFLO21CQUNMLEtBQUs7cUJBQ0wsS0FBSztrQkFDTCxLQUFLO3NCQUVMLE1BQU07MEJBQ04sTUFBTTt3QkFDTixNQUFNOzJCQUNOLE1BQU07dUJBYU4sWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7OztJQTlCekMsaUNBQTJCOztJQUMzQixrQ0FBdUI7O0lBQ3ZCLG1DQUF3Qjs7SUFDeEIsaUNBQXNCOztJQUN0QixxQ0FBMkI7O0lBQzNCLG1DQUF5Qjs7SUFDekIsd0NBQXlDOztJQUN6Qyw0Q0FBa0M7O0lBQ2xDLDJDQUFpQzs7SUFDakMsdUNBQTRCOztJQUM1QixpQ0FBc0I7O0lBQ3RCLG1DQUE4Qjs7SUFDOUIsZ0NBQXVDOztJQUV2QyxvQ0FBaUU7O0lBQ2pFLHdDQUF5RTs7SUFDekUsc0NBQThEOztJQUM5RCx5Q0FBaUU7Ozs7O0lBRWpFLG9DQUE2Qjs7Ozs7SUFDN0IsK0NBQStDOzs7OztJQUUvQyxvQ0FBc0M7Ozs7O0lBQ3RDLHNDQUFrQjs7Ozs7SUFHaEIsK0JBQXNCOzs7OztJQUN0QiwrQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsXG4gICAgICAgICBPbkNoYW5nZXMsXG4gICAgICAgICBBZnRlckNvbnRlbnRJbml0LFxuICAgICAgICAgQWZ0ZXJDb250ZW50Q2hlY2tlZCxcbiAgICAgICAgIElucHV0LFxuICAgICAgICAgT3V0cHV0LFxuICAgICAgICAgRXZlbnRFbWl0dGVyLFxuICAgICAgICAgRWxlbWVudFJlZixcbiAgICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgICAgICBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENsb3VkRGF0YSwgQ2xvdWRPcHRpb25zLCBab29tT25Ib3Zlck9wdGlvbnMgfSBmcm9tICcuL3RhZy1jbG91ZC5pbnRlcmZhY2VzJztcblxuaW50ZXJmYWNlIENsb3VkT3B0aW9uc0ludGVybmFsIGV4dGVuZHMgQ2xvdWRPcHRpb25zIHtcbiAgLyoqXG4gICAqIHNldHRpbmcgdGhlIGFzcGVjdCByYXRpby4gVGhpcyB2YWx1ZSBpcyBjYWxjdWxhdGVkIGJ5IHRoZSBnaXZlbiB3aWR0aCBhbmQgaGVpZ2h0XG4gICAqL1xuICBhc3BlY3RSYXRpbzogbnVtYmVyO1xuICBjZW50ZXI6IHtcbiAgICB4OiBudW1iZXI7XG4gICAgeTogbnVtYmVyO1xuICB9O1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhbmd1bGFyLXRhZy1jbG91ZCwgbmctdGFnLWNsb3VkLCBuZ3RjJyxcbiAgdGVtcGxhdGU6ICcnLFxuICBzdHlsZVVybHM6IFsnLi90YWctY2xvdWQuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFRhZ0Nsb3VkQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlckNvbnRlbnRJbml0LCBBZnRlckNvbnRlbnRDaGVja2VkIHtcbiAgQElucHV0KCkgZGF0YTogQ2xvdWREYXRhW107XG4gIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICBASW5wdXQoKSBzdGVwOiBudW1iZXI7XG4gIEBJbnB1dCgpIG92ZXJmbG93OiBib29sZWFuO1xuICBASW5wdXQoKSBzdHJpY3Q6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHpvb21PbkhvdmVyOiBab29tT25Ib3Zlck9wdGlvbnM7XG4gIEBJbnB1dCgpIHJlYWxpZ25PblJlc2l6ZTogYm9vbGVhbjtcbiAgQElucHV0KCkgcmFuZG9taXplQW5nbGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGJhY2tncm91bmQ6IHN0cmluZztcbiAgQElucHV0KCkgZm9udDogc3RyaW5nO1xuICBASW5wdXQoKSBjb25maWc6IENsb3VkT3B0aW9ucztcbiAgQElucHV0KCkgbG9nOiAnd2FybicgfCAnZGVidWcnIHwgZmFsc2U7XG5cbiAgQE91dHB1dCgpIGNsaWNrZWQ/OiBFdmVudEVtaXR0ZXI8Q2xvdWREYXRhPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGRhdGFDaGFuZ2VzPzogRXZlbnRFbWl0dGVyPFNpbXBsZUNoYW5nZXM+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgYWZ0ZXJJbml0PzogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgYWZ0ZXJDaGVja2VkPzogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByaXZhdGUgZGF0YUFycjogQ2xvdWREYXRhW107XG4gIHByaXZhdGUgYWxyZWFkeVBsYWNlZFdvcmRzOiBIVE1MRWxlbWVudFtdID0gW107XG5cbiAgcHJpdmF0ZSBvcHRpb25zOiBDbG91ZE9wdGlvbnNJbnRlcm5hbDtcbiAgcHJpdmF0ZSB0aW1lb3V0SWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHIyOiBSZW5kZXJlcjJcbiAgKSB7IH1cblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJywgWyckZXZlbnQnXSkgb25SZXNpemUoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMubG9nTWVzc2FnZShcbiAgICAgICdkZWJ1ZycsXG4gICAgICAncmV6aXN6ZSB0cmlnZ2VyZWQnXG4gICAgKTtcbiAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTtcbiAgICB0aGlzLnRpbWVvdXRJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVhbGlnbk9uUmVzaXplKSB7XG4gICAgICAgIHRoaXMucmVEcmF3KCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICB0aGlzLmxvZ01lc3NhZ2UoXG4gICAgICAnZGVidWcnLFxuICAgICAgJ25nT25DaGFuZ2VzIGZpcmVkJyxcbiAgICAgIGNoYW5nZXNcbiAgICApO1xuICAgIC8vIHNldCBkZWZhdWx0IHZhbHVlc1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgd2lkdGg6IDUwMCxcbiAgICAgIGhlaWdodDogMzAwLFxuICAgICAgb3ZlcmZsb3c6IHRydWUsXG4gICAgICBzdHJpY3Q6IGZhbHNlLFxuICAgICAgem9vbU9uSG92ZXI6IHtcbiAgICAgICAgdHJhbnNpdGlvblRpbWU6IDAsXG4gICAgICAgIHNjYWxlOiAxLFxuICAgICAgICBkZWxheTogMCxcbiAgICAgICAgY29sb3I6IG51bGxcbiAgICAgIH0sXG4gICAgICByZWFsaWduT25SZXNpemU6IGZhbHNlLFxuICAgICAgcmFuZG9taXplQW5nbGU6IGZhbHNlLFxuICAgICAgYmFja2dyb3VuZDogbnVsbCxcbiAgICAgIGZvbnQ6IG51bGwsXG4gICAgICBzdGVwOiAyLjAsXG4gICAgICBsb2c6IGZhbHNlLFxuICAgICAgLi4udGhpcy5jb25maWcgLy8gb3ZlcnJpZGUgZGVmYXVsdCB3aWR0aCBwYXJhbXMgaW4gY29uZmlnIG9iamVjdFxuICAgIH07XG5cbiAgICAvLyBvdmVycmlkZSBwcm9wZXJ0aWVzIGlmIGV4cGxpY2l0bHkgc2V0XG4gICAgaWYgKHRoaXMud2lkdGgpIHsgdGhpcy5jb25maWcud2lkdGggPSB0aGlzLndpZHRoOyB9XG4gICAgaWYgKHRoaXMuaGVpZ2h0KSB7IHRoaXMuY29uZmlnLmhlaWdodCA9IHRoaXMuaGVpZ2h0OyB9XG4gICAgaWYgKHR5cGVvZiB0aGlzLm92ZXJmbG93ID09PSAnYm9vbGVhbicpIHsgdGhpcy5jb25maWcub3ZlcmZsb3cgPSB0aGlzLm92ZXJmbG93OyB9XG4gICAgaWYgKHR5cGVvZiB0aGlzLnN0cmljdCA9PT0gJ2Jvb2xlYW4nKSB7IHRoaXMuY29uZmlnLnN0cmljdCA9IHRoaXMuc3RyaWN0OyB9XG4gICAgaWYgKHR5cGVvZiB0aGlzLnJlYWxpZ25PblJlc2l6ZSA9PT0gJ2Jvb2xlYW4nKSB7IHRoaXMuY29uZmlnLnJlYWxpZ25PblJlc2l6ZSA9IHRoaXMucmVhbGlnbk9uUmVzaXplOyB9XG4gICAgaWYgKHR5cGVvZiB0aGlzLnJhbmRvbWl6ZUFuZ2xlID09PSAnYm9vbGVhbicpIHsgdGhpcy5jb25maWcucmFuZG9taXplQW5nbGUgPSB0aGlzLnJhbmRvbWl6ZUFuZ2xlOyB9XG4gICAgaWYgKHR5cGVvZiB0aGlzLmJhY2tncm91bmQgPT09ICdzdHJpbmcnKSB7IHRoaXMuY29uZmlnLmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQ7IH1cbiAgICBpZiAodHlwZW9mIHRoaXMuZm9udCA9PT0gJ3N0cmluZycpIHsgdGhpcy5jb25maWcuZm9udCA9IHRoaXMuZm9udDsgfVxuICAgIGlmICh0aGlzLnpvb21PbkhvdmVyKSB7IHRoaXMuY29uZmlnLnpvb21PbkhvdmVyID0gdGhpcy56b29tT25Ib3ZlcjsgfVxuICAgIGlmICh0aGlzLnN0ZXApIHsgdGhpcy5jb25maWcuc3RlcCA9IHRoaXMuc3RlcDsgfVxuICAgIGlmICh0aGlzLmxvZykgeyB0aGlzLmNvbmZpZy5sb2cgPSB0aGlzLmxvZzsgfVxuXG4gICAgdGhpcy5sb2dNZXNzYWdlKCd3YXJuJywgJ2Nsb3VkIGNvbmZpZ3VyYXRpb24nLCB0aGlzLmNvbmZpZyk7XG5cbiAgICAvLyBzZXQgdGhlIGJhc2ljIGZvbnQgc3R5bGUgaWYgcHJvcGVydHkgaXMgcHJvdmlkZWRcbiAgICBpZiAodGhpcy5jb25maWcuZm9udCkge1xuICAgICAgdGhpcy5yMi5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmb250JywgdGhpcy5jb25maWcuZm9udCk7XG4gICAgfVxuXG4gICAgLy8gc2V0IGEgYmFja2dyb3VuZCBpbWFnZSBpZiBwcm9wZXJ0eSBpcyBwcm92aWRlZFxuICAgIGlmICh0aGlzLmNvbmZpZy5iYWNrZ3JvdW5kKSB7XG4gICAgICB0aGlzLnIyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2JhY2tncm91bmQnLCB0aGlzLmNvbmZpZy5iYWNrZ3JvdW5kKTtcbiAgICB9XG5cblxuICAgIHRoaXMucmVEcmF3KGNoYW5nZXMpO1xuICB9XG5cbiAgcmVEcmF3KGNoYW5nZXM/OiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgdGhpcy5kYXRhQ2hhbmdlcy5lbWl0KGNoYW5nZXMpO1xuICAgIHRoaXMuYWZ0ZXJDaGVja2VkLmVtaXQoKTtcbiAgICB0aGlzLmxvZ01lc3NhZ2UoXG4gICAgICAnZGVidWcnLFxuICAgICAgJ2RhdGFDaGFuZ2VzIGVtaXR0ZWQnXG4gICAgKTtcbiAgICB0aGlzLmFscmVhZHlQbGFjZWRXb3JkcyA9IFtdO1xuXG4gICAgLy8gY2hlY2sgaWYgZGF0YSBpcyBub3QgbnVsbCBvciBlbXB0eVxuICAgIGlmICghdGhpcy5kYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdhbmd1bGFyLXRhZy1jbG91ZDogTm8gZGF0YSBwYXNzZWQuIFBsZWFzZSBwYXNzIGFuIEFycmF5IG9mIENsb3VkRGF0YScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHZhbHVlcyBjaGFuZ2VkLCByZXNldCBjbG91ZFxuICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vIHNldCB2YWx1ZSBjaGFuZ2VzXG4gICAgaWYgKGNoYW5nZXMgJiYgY2hhbmdlcy5kYXRhKSB7XG4gICAgICB0aGlzLmRhdGFBcnIgPSBjaGFuZ2VzLmRhdGEuY3VycmVudFZhbHVlO1xuICAgIH1cblxuICAgIC8vIGNhbGN1bGF0ZSB3aWR0aCBhbmQgaGVpZ2h0XG4gICAgbGV0IHdpZHRoID0gdGhpcy5jb25maWcud2lkdGg7XG4gICAgaWYgKHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLm9mZnNldFdpZHRoID4gMFxuICAgICAgJiYgd2lkdGggPD0gMVxuICAgICAgJiYgd2lkdGggPiAwXG4gICAgKSB7XG4gICAgICB3aWR0aCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLm9mZnNldFdpZHRoICogd2lkdGg7XG4gICAgfVxuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuY29uZmlnLmhlaWdodDtcblxuICAgIC8vIHNldCBvcHRpb25zXG4gICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgLi4udGhpcy5jb25maWcsXG4gICAgICBhc3BlY3RSYXRpbzogKHdpZHRoIC8gaGVpZ2h0KSxcbiAgICAgIHdpZHRoLFxuICAgICAgY2VudGVyOiB7XG4gICAgICAgIHg6ICh3aWR0aCAvIDIuMCksXG4gICAgICAgIHk6IChoZWlnaHQgLyAyLjApXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIHNldCB0aGUgZGltZW5zaW9uc1xuICAgIHRoaXMucjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCB0aGlzLm9wdGlvbnMud2lkdGggKyAncHgnKTtcbiAgICB0aGlzLnIyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRoaXMub3B0aW9ucy5oZWlnaHQgKyAncHgnKTtcblxuICAgIC8vIGRyYXcgdGhlIGNsb3VkXG4gICAgdGhpcy5kcmF3V29yZENsb3VkKCk7XG4gICAgdGhpcy5sb2dNZXNzYWdlKFxuICAgICAgJ2RlYnVnJyxcbiAgICAgICdyZURyYXcgZmluaXNoZWQnXG4gICAgKTtcbiAgfVxuXG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuYWZ0ZXJJbml0LmVtaXQoKTtcbiAgICB0aGlzLmxvZ01lc3NhZ2UoXG4gICAgICAnZGVidWcnLFxuICAgICAgJ2FmdGVySW5pdCBlbWl0dGVkJ1xuICAgICk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgdGhpcy5hZnRlckNoZWNrZWQuZW1pdCgpO1xuICAgIHRoaXMubG9nTWVzc2FnZShcbiAgICAgICdkZWJ1ZycsXG4gICAgICAnYWZ0ZXJDaGVja2VkIGVtaXR0ZWQnXG4gICAgKTtcbiAgfVxuXG4gIC8vIGhlbHBlciB0byBnZW5lcmF0ZSBhIGRlc2NyaXB0aXZlIHN0cmluZyBmb3IgYW4gZW50cnkgdG8gdXNlIHdoZW4gc29ydGluZyBhbHBoYWJldGljYWxseVxuICBwcml2YXRlIGRlc2NyaXB0aXZlRW50cnkoZW50cnk6IENsb3VkRGF0YSk6IHN0cmluZyB7XG4gICAgbGV0IGRlc2NyaXB0aW9uID0gZW50cnkudGV4dDtcbiAgICBpZiAoZW50cnkuY29sb3IpIHtcbiAgICAgIGRlc2NyaXB0aW9uICs9ICctJyArIGVudHJ5LmNvbG9yO1xuICAgIH1cbiAgICBpZiAoZW50cnkuZXh0ZXJuYWwpIHtcbiAgICAgIGRlc2NyaXB0aW9uICs9ICctJyArIGVudHJ5LmV4dGVybmFsO1xuICAgIH1cbiAgICBpZiAoZW50cnkubGluaykge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkubGluaztcbiAgICB9XG4gICAgaWYgKGVudHJ5LnJvdGF0ZSkge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkucm90YXRlO1xuICAgIH1cbiAgICByZXR1cm4gZGVzY3JpcHRpb247XG4gIH1cblxuICBwcml2YXRlIGRyYXdXb3JkQ2xvdWQoKSB7XG4gICAgLy8gU29ydCBhbHBoYWJldGljYWxseSB0byBlbnN1cmUgdGhhdCwgYWxsIHRoaW5ncyBiZWluZyBlcXVhbCwgd29yZHMgYXJlIHBsYWNlZCB1bmlmb3JtbHlcbiAgICB0aGlzLmRhdGFBcnIuc29ydCgoYSwgYikgPT4gKHRoaXMuZGVzY3JpcHRpdmVFbnRyeShhKSkubG9jYWxlQ29tcGFyZSh0aGlzLmRlc2NyaXB0aXZlRW50cnkoYikpKTtcbiAgICAvLyBTb3J0IHRoaXMuX2RhdGFBcnIgZnJvbSB0aGUgd29yZCB3aXRoIHRoZSBoaWdoZXN0IHdlaWdodCB0byB0aGUgb25lIHdpdGggdGhlIGxvd2VzdFxuICAgIHRoaXMuZGF0YUFyci5zb3J0KChhLCBiKSA9PiBiLndlaWdodCAtIGEud2VpZ2h0KTtcbiAgICB0aGlzLmRhdGFBcnIuZm9yRWFjaCgoZWxlbSwgaW5kZXgpID0+IHtcbiAgICAgIHRoaXMuZHJhd1dvcmQoaW5kZXgsIGVsZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHRlc3QgaWYgYW4gZWxlbWVudCBvdmVybGFwcyBvdGhlcnNcbiAgcHJpdmF0ZSBoaXRUZXN0KHRlc3RFbDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICAvLyBDaGVjayBlbGVtZW50cyBmb3Igb3ZlcmxhcCBvbmUgYnkgb25lLCBzdG9wIGFuZCByZXR1cm4gZmFsc2UgYXMgc29vbiBhcyBhbiBvdmVybGFwIGlzIGZvdW5kXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuYWxyZWFkeVBsYWNlZFdvcmRzKSB7XG4gICAgICBpZiAodGhpcy5vdmVybGFwcGluZyh0ZXN0RWwsIGl0ZW0pKSB7IHJldHVybiB0cnVlOyB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFBhaXJ3aXNlIG92ZXJsYXAgZGV0ZWN0aW9uXG4gIHByaXZhdGUgb3ZlcmxhcHBpbmcoZTE6IEhUTUxFbGVtZW50LCBlMjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWN0MSA9IGUxLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHJlY3QyID0gZTIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBjb25zdCBvdmVybGFwID0gIShcbiAgICAgIHJlY3QxLnJpZ2h0IDwgcmVjdDIubGVmdCB8fFxuICAgICAgcmVjdDEubGVmdCA+IHJlY3QyLnJpZ2h0IHx8XG4gICAgICByZWN0MS5ib3R0b20gPCByZWN0Mi50b3AgfHxcbiAgICAgIHJlY3QxLnRvcCA+IHJlY3QyLmJvdHRvbVxuICAgICk7XG4gICAgcmV0dXJuIG92ZXJsYXA7XG4gIH1cblxuICAvLyBGdW5jdGlvbiB0byBkcmF3IGEgd29yZCwgYnkgbW92aW5nIGl0IGluIHNwaXJhbCB1bnRpbCBpdCBmaW5kcyBhIHN1aXRhYmxlIGVtcHR5IHBsYWNlLiBUaGlzIHdpbGwgYmUgaXRlcmF0ZWQgb24gZWFjaCB3b3JkLlxuICBwcml2YXRlIGRyYXdXb3JkKGluZGV4OiBudW1iZXIsIHdvcmQ6IENsb3VkRGF0YSkge1xuICAgIC8vIERlZmluZSB0aGUgSUQgYXR0cmlidXRlIG9mIHRoZSBzcGFuIHRoYXQgd2lsbCB3cmFwIHRoZSB3b3JkXG4gICAgbGV0IGFuZ2xlID0gdGhpcy5vcHRpb25zLnJhbmRvbWl6ZUFuZ2xlID8gNi4yOCAqIE1hdGgucmFuZG9tKCkgOiAwO1xuICAgIGxldCByYWRpdXMgPSAwO1xuICAgIGxldCB3ZWlnaHQgPSA1O1xuICAgIGxldCB3b3JkU3BhbjogSFRNTEVsZW1lbnQ7XG5cbiAgICAvLyBDaGVjayBpZiBtaW4od2VpZ2h0KSA+IG1heCh3ZWlnaHQpIG90aGVyd2lzZSB1c2UgZGVmYXVsdFxuICAgIGlmICh0aGlzLmRhdGFBcnJbMF0ud2VpZ2h0ID4gdGhpcy5kYXRhQXJyW3RoaXMuZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpIHtcbiAgICAgIC8vIGNoZWNrIGlmIHN0cmljdCBtb2RlIGlzIGFjdGl2ZVxuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc3RyaWN0KSB7IC8vIExpbmVhcmx5IG1hcCB0aGUgb3JpZ2luYWwgd2VpZ2h0IHRvIGEgZGlzY3JldGUgc2NhbGUgZnJvbSAxIHRvIDEwXG4gICAgICAgIHdlaWdodCA9IE1hdGgucm91bmQoKHdvcmQud2VpZ2h0IC0gdGhpcy5kYXRhQXJyW3RoaXMuZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpIC9cbiAgICAgICAgICAgICAgICAgICh0aGlzLmRhdGFBcnJbMF0ud2VpZ2h0IC0gdGhpcy5kYXRhQXJyW3RoaXMuZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpICogOS4wKSArIDE7XG4gICAgICB9IGVsc2UgeyAvLyB1c2UgZ2l2ZW4gdmFsdWUgZm9yIHdlaWd0aCBkaXJlY3RseVxuICAgICAgICAvLyBmYWxsYmFjayB0byAxMFxuICAgICAgICBpZiAod29yZC53ZWlnaHQgPiAxMCkge1xuICAgICAgICAgIHdlaWdodCA9IDEwO1xuICAgICAgICAgIHRoaXMubG9nTWVzc2FnZShcbiAgICAgICAgICAgICd3YXJuJyxcbiAgICAgICAgICAgIGBbVGFnQ2xvdWQgc3RyaWN0XSBXZWlnaHQgcHJvcGVydHkgJHt3b3JkLndlaWdodH0gPiAxMC4gRmFsbGJhY2sgdG8gMTAgYXMgeW91IGFyZSB1c2luZyBzdHJpY3QgbW9kZWAsXG4gICAgICAgICAgICB3b3JkXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh3b3JkLndlaWdodCA8IDEpIHsgLy8gZmFsbGJhY2sgdG8gMVxuICAgICAgICAgIHdlaWdodCA9IDE7XG4gICAgICAgICAgdGhpcy5sb2dNZXNzYWdlKFxuICAgICAgICAgICAgJ3dhcm4nLFxuICAgICAgICAgICAgYFtUYWdDbG91ZCBzdHJpY3RdIEdpdmVuIHdlaWdodCBwcm9wZXJ0eSAke3dvcmQud2VpZ2h0fSA8IDEuIEZhbGxiYWNrIHRvIDEgYXMgeW91IGFyZSB1c2luZyBzdHJpY3QgbW9kZWAsXG4gICAgICAgICAgICB3b3JkXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh3b3JkLndlaWdodCAlIDEgIT09IDApIHsgLy8gcm91bmQgaWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgICB3ZWlnaHQgPSBNYXRoLnJvdW5kKHdvcmQud2VpZ2h0KTtcbiAgICAgICAgICB0aGlzLmxvZ01lc3NhZ2UoXG4gICAgICAgICAgICAnd2FybicsXG4gICAgICAgICAgICBgW1RhZ0Nsb3VkIHN0cmljdF0gR2l2ZW4gd2VpZ2h0IHByb3BlcnR5ICR7d29yZC53ZWlnaHR9IGlzIG5vdCBhbiBpbnRlZ2VyLiBSb3VuZGVkIHZhbHVlIHRvICR7d2VpZ2h0fWAsXG4gICAgICAgICAgICB3b3JkXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3ZWlnaHQgPSB3b3JkLndlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IHNwYW4gYW5kIGluc2VydCBub2RlLlxuICAgIHdvcmRTcGFuID0gdGhpcy5yMi5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgd29yZFNwYW4uY2xhc3NOYW1lID0gJ3cnICsgd2VpZ2h0O1xuXG4gICAgY29uc3QgdGhhdENsaWNrZWQgPSB0aGlzLmNsaWNrZWQ7XG4gICAgd29yZFNwYW4ub25jbGljayA9ICgpID0+IHtcbiAgICAgIHRoYXRDbGlja2VkLmVtaXQod29yZCk7XG4gICAgfTtcblxuICAgIGxldCBub2RlID0gdGhpcy5yMi5jcmVhdGVUZXh0KHdvcmQudGV4dCk7XG5cbiAgICAvLyBzZXQgY29sb3JcbiAgICBpZiAod29yZC5jb2xvcikge1xuICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ2NvbG9yJywgd29yZC5jb2xvcik7XG4gICAgfVxuXG4gICAgbGV0IHRyYW5zZm9ybVN0cmluZyA9ICcnO1xuXG4gICAgLy8gc2V0IGNvbG9yXG4gICAgaWYgKHdvcmQucm90YXRlKSB7XG4gICAgICB0cmFuc2Zvcm1TdHJpbmcgPSBgcm90YXRlKCR7d29yZC5yb3RhdGV9ZGVnKWA7XG4gICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNmb3JtJywgdHJhbnNmb3JtU3RyaW5nKTtcbiAgICB9XG5cbiAgICAvLyBBcHBlbmQgaHJlZiBpZiB0aGVyZSdzIGEgbGluayBhbG9uZ3dpdGggdGhlIHRhZ1xuICAgIGlmICh3b3JkLmxpbmspIHtcbiAgICAgIGNvbnN0IHdvcmRMaW5rID0gdGhpcy5yMi5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICB3b3JkTGluay5ocmVmID0gd29yZC5saW5rO1xuXG4gICAgICBpZiAod29yZC5leHRlcm5hbCAhPT0gdW5kZWZpbmVkICYmIHdvcmQuZXh0ZXJuYWwpIHtcbiAgICAgICAgd29yZExpbmsudGFyZ2V0ID0gJ19ibGFuayc7XG4gICAgICB9XG5cbiAgICAgIHdvcmRMaW5rLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgbm9kZSA9IHdvcmRMaW5rO1xuICAgIH1cblxuICAgIC8vIHNldCB6b29tT3B0aW9uXG4gICAgaWYgKHRoaXMub3B0aW9ucy56b29tT25Ib3ZlciAmJiB0aGlzLm9wdGlvbnMuem9vbU9uSG92ZXIuc2NhbGUgIT09IDEpIHtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnpvb21PbkhvdmVyLnRyYW5zaXRpb25UaW1lKSB7IHRoaXMub3B0aW9ucy56b29tT25Ib3Zlci50cmFuc2l0aW9uVGltZSA9IDA7IH1cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnpvb21PbkhvdmVyLnNjYWxlKSB7IHRoaXMub3B0aW9ucy56b29tT25Ib3Zlci5zY2FsZSA9IDE7IH1cblxuICAgICAgd29yZFNwYW4ub25tb3VzZW92ZXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMucjIuc2V0U3R5bGUod29yZFNwYW4sICd0cmFuc2l0aW9uJywgYHRyYW5zZm9ybSAke3RoaXMub3B0aW9ucy56b29tT25Ib3Zlci50cmFuc2l0aW9uVGltZX1zYCk7XG4gICAgICAgIHRoaXMucjIuc2V0U3R5bGUod29yZFNwYW4sICd0cmFuc2Zvcm0nLCBgc2NhbGUoJHt0aGlzLm9wdGlvbnMuem9vbU9uSG92ZXIuc2NhbGV9KSAke3RyYW5zZm9ybVN0cmluZ31gKTtcbiAgICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ3RyYW5zaXRpb24tZGVsYXknLCBgJHt0aGlzLm9wdGlvbnMuem9vbU9uSG92ZXIuZGVsYXl9c2ApO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnpvb21PbkhvdmVyLmNvbG9yKSB7XG4gICAgICAgICAgd29yZC5saW5rXG4gICAgICAgICAgICA/IHRoaXMucjIuc2V0U3R5bGUobm9kZSwgJ2NvbG9yJywgdGhpcy5vcHRpb25zLnpvb21PbkhvdmVyLmNvbG9yKVxuICAgICAgICAgICAgOiB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAnY29sb3InLCB0aGlzLm9wdGlvbnMuem9vbU9uSG92ZXIuY29sb3IpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB3b3JkU3Bhbi5vbm1vdXNlb3V0ID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNmb3JtJywgYG5vbmUgJHt0cmFuc2Zvcm1TdHJpbmd9YCk7XG4gICAgICAgIHdvcmQubGlua1xuICAgICAgICAgID8gdGhpcy5yMi5yZW1vdmVTdHlsZShub2RlLCAnY29sb3InKVxuICAgICAgICAgIDogdGhpcy5yMi5yZW1vdmVTdHlsZSh3b3JkU3BhbiwgJ2NvbG9yJyk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIHdvcmRTcGFuLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIHRoaXMucjIuYXBwZW5kQ2hpbGQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCB3b3JkU3Bhbik7XG5cbiAgICBjb25zdCB3aWR0aCA9IHdvcmRTcGFuLm9mZnNldFdpZHRoO1xuICAgIGNvbnN0IGhlaWdodCA9IHdvcmRTcGFuLm9mZnNldEhlaWdodDtcbiAgICBsZXQgbGVmdCA9IHRoaXMub3B0aW9ucy5jZW50ZXIueCAtICh3aWR0aCAvIDIpO1xuICAgIGxldCB0b3AgPSB0aGlzLm9wdGlvbnMuY2VudGVyLnkgLSAoaGVpZ2h0IC8gMik7XG5cbiAgICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSBzdHlsZSBwcm9wZXJ0eSwgZm9yIGJldHRlciBwZXJmb3JtYW5jZVxuICAgIGNvbnN0IHdvcmRTdHlsZSA9IHdvcmRTcGFuLnN0eWxlO1xuICAgIHdvcmRTdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG5cbiAgICAvLyBwbGFjZSB0aGUgZmlyc3Qgd29yZFxuICAgIHdvcmRTdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7XG4gICAgd29yZFN0eWxlLnRvcCA9IHRvcCArICdweCc7XG5cbiAgICAvLyBhZGQgdG9vbHRpcCBpZiBwcm92aWRlZFxuICAgIGlmICh3b3JkLnRvb2x0aXApIHtcbiAgICAgIHRoaXMucjIuYWRkQ2xhc3Mod29yZFNwYW4sICd0b29sdGlwJyk7XG4gICAgICBjb25zdCB0b29sdGlwU3BhbiA9IHRoaXMucjIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgdG9vbHRpcFNwYW4uY2xhc3NOYW1lID0gJ3Rvb2x0aXB0ZXh0JztcbiAgICAgIGNvbnN0IHRleHQgPSB0aGlzLnIyLmNyZWF0ZVRleHQod29yZC50b29sdGlwKTtcbiAgICAgIHRvb2x0aXBTcGFuLmFwcGVuZENoaWxkKHRleHQpO1xuICAgICAgd29yZFNwYW4uYXBwZW5kQ2hpbGQodG9vbHRpcFNwYW4pO1xuICAgIH1cblxuICAgIC8vIHNldCBhIHVuaXF1ZSBpZFxuICAgIHdvcmRTcGFuLmlkID0gYGFuZ3VsYXItdGFnLWNsb3VkLWl0ZW0tJHtpbmRleH1gO1xuXG4gICAgd2hpbGUgKHRoaXMuaGl0VGVzdCh3b3JkU3BhbikpIHtcbiAgICAgIHJhZGl1cyArPSB0aGlzLm9wdGlvbnMuc3RlcDtcbiAgICAgIGFuZ2xlICs9IChpbmRleCAlIDIgPT09IDAgPyAxIDogLTEpICogdGhpcy5vcHRpb25zLnN0ZXA7XG5cbiAgICAgIGxlZnQgPSB0aGlzLm9wdGlvbnMuY2VudGVyLnggLSAod2lkdGggLyAyLjApICsgKHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSkgKiB0aGlzLm9wdGlvbnMuYXNwZWN0UmF0aW87XG4gICAgICB0b3AgPSB0aGlzLm9wdGlvbnMuY2VudGVyLnkgKyByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkgLSAoaGVpZ2h0IC8gMi4wKTtcblxuICAgICAgd29yZFN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgICAgIHdvcmRTdHlsZS50b3AgPSB0b3AgKyAncHgnO1xuICAgIH1cblxuICAgIC8vIGRvIG5vdCBwbGFjZSB0aGUgZmlyc3Qgd29yZCBhbHdheXMgcmlnaHQgaW4gdGhlIG1pZGRsZVxuICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgd29yZFN0eWxlLmxlZnQgPSBsZWZ0ICsgKChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIpICogKHRoaXMub3B0aW9ucy53aWR0aCAvIDUpICsgJ3B4JztcbiAgICAgIHdvcmRTdHlsZS50b3AgPSB0b3AgKyAoKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMikgKiAodGhpcy5vcHRpb25zLmhlaWdodCAvIDUpICsgJzMwcHgnO1xuICAgIH1cblxuICAgIC8vIERvbid0IHJlbmRlciB3b3JkIGlmIHBhcnQgb2YgaXQgd291bGQgYmUgb3V0c2lkZSB0aGUgY29udGFpbmVyXG4gICAgaWYgKFxuICAgICAgIXRoaXMub3B0aW9ucy5vdmVyZmxvdyAmJlxuICAgICAgKGxlZnQgPCAwIHx8IHRvcCA8IDAgfHwgKGxlZnQgKyB3aWR0aCkgPiB0aGlzLm9wdGlvbnMud2lkdGggfHxcbiAgICAgICh0b3AgKyBoZWlnaHQpID4gdGhpcy5vcHRpb25zLmhlaWdodClcbiAgICApIHtcbiAgICAgIHRoaXMubG9nTWVzc2FnZShcbiAgICAgICAgJ3dhcm4nLFxuICAgICAgICAnV29yZCBkaWQgbm90IGZpdCBpbnRvIHRoZSBjbG91ZCBhbmQgb3ZlcmZsb3cgaXMgc2V0IHRvIFxcJ2ZhbHNlXFwnLiBUaGUgZWxlbWVudCB3aWxsIGJlIHJlbW92ZWQnLFxuICAgICAgICB3b3JkU3BhblxuICAgICAgKTtcbiAgICAgIHdvcmRTcGFuLnJlbW92ZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubG9nTWVzc2FnZShcbiAgICAgICdkZWJ1ZycsXG4gICAgICAnQWRkcyBuZXcgd29yZCA8c3Bhbj4nLFxuICAgICAgd29yZFNwYW5cbiAgICApO1xuICAgIHRoaXMuYWxyZWFkeVBsYWNlZFdvcmRzLnB1c2god29yZFNwYW4pO1xuXG4gICAgdGhpcy5sb2dNZXNzYWdlKFxuICAgICAgJ2RlYnVnJyxcbiAgICAgICdQbGFjZWQgd29yZHMnLFxuICAgICAgdGhpcy5hbHJlYWR5UGxhY2VkV29yZHNcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2dNZXNzYWdlKGxldmVsOiAnd2FybicgfCAnZGVidWcnIHwgZmFsc2UsIC4uLmFyZ3M6IGFueSkge1xuICAgIGlmICghdGhpcy5jb25maWcpIHsgcmV0dXJuOyB9XG4gICAgaWYgKHRoaXMuY29uZmlnLmxvZyA9PT0gJ2RlYnVnJykge1xuICAgICAgY29uc29sZS5sb2coYFtBbmd1bGFyVGFnQ2xvdWRNb2R1bGUgJHtsZXZlbH1dYCwgLi4uYXJncyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5sb2cgPT09ICd3YXJuJyAmJiBsZXZlbCA9PT0gJ3dhcm4nKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFtBbmd1bGFyVGFnQ2xvdWRNb2R1bGUgJHtsZXZlbH1dYCwgLi4uYXJncyk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==